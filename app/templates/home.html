{% extends 'base.html' %}


{% block body %}

<div class="container mt-4">

  <!-- Titolo -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="text-primary">History News</h2>
    <span class="badge badge-info p-2">
      Totale articoli: {{ total }}
    </span>
  </div>

  {% if history %}
  <!-- Tabella articoli -->
  <div class="table-responsive">
    <table class="table table-striped table-hover shadow-sm rounded">
      <thead class="thead-dark">
        <tr>
          <th scope="col">Topic</th>
          <th scope="col">Abstract</th>
          <th scope="col">Link</th>
          <th scope="col">Data</th>
        </tr>
      </thead>
      <tbody>

        {% for article in history %}

        <tr>
          <td> <strong> {{ article.topic }} </strong> </td>

          {% if article.abstract|length <= 70 %}
            <td>{{ article.abstract }}</td>
          {% else %}
            <td>{{ article.abstract[:70] ~ ' ...'}}</td>
          {% endif %}

          <td>
            {% if article.link %}
              <a href="{{ article.link }}" target="_blank" class="btn btn-sm btn-outline-primary">
                Clicca qui
              </a>
            {% else %}
              <span class="text-muted">N/D</span>
            {% endif %}
          </td>
          <td>{{ article.date.strftime('%d-%m-%Y') if article.date else 'N/D' }}</td>

        </tr>

        {% endfor %}

      </tbody>
    </table>
  </div>


{% else %}

    <div class="alert alert-warning text-center shadow-sm" role="alert">
      Nessun articolo presente nello storico. Fai web-scraping per aggiungerne!
    </div>

{% endif %}

  <!-- Bottone per scraping -->
  <div class="text-center mt-4">
    <form method="POST" action="{{ url_for('main.scrape') }}">
      <button type="submit" class="btn btn-success btn-lg shadow-sm">
        <i class="fa fa-refresh"></i> Fai web-scraping
      </button>
    </form>
  </div>

</div>
{% endblock %}
